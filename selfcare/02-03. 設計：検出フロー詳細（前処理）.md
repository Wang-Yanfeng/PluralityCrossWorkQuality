# 検出フロー詳細（前処理）
## 分析フローの再設計  
  
①議事録前処理ステップ→本ページ  
1. セグメント分割処理  
2. セグメントごとのメタデータ推定  
3. 会議全体のメタデータ推定  
4. 話者情報推定  
  
②MA検出フォーカスポイント抽出ステップ→本ページ  
1. 認知バイアス型/社会構造型MA検出ポイント（=リスク分析）  
2. 書籍選定: リスク分析結果を基に、関連する書籍データベースを選定  
    * 認知バイアス型用の書籍選定 → list_cognitive_index_name  
    * 社会構造型用の書籍選定 → list_structural_index_name  
  
③本分析（graphRAG）→別ページ  
  
下記、①②各ステップの詳細設計・実装  
  
## ①議事録前処理ステップ  
### 基本プロセス  
1. セグメント分割（N文ごと、5-10分単位）  
2. セグメント単位のメタデータ推定  
3. 2の分析結果をもとに会議全体のメタデータ集約（話者情報推定含む）  
4. 分析結果の信頼性スコア提示（優先度下）  
  
### セグメント分割  
* 10分のセグメントに分割（10分=3000字と仮定）→overlapする（10発話分）  
* 話者ごとの発言で分割（長すぎない限り話者ごとに区切る）長すぎる場合は、区切る  
* 複数セグメント・複数トピックの扱いについて（トピックではなくオーバーラップで対応する） 
    * セグメント分割の際にオーバーラップさせる
        * メリット:
            文脈の連続性が自然に維持される
            発言の途中で切れる問題を防止
            隣接セグメント境界の会話フローを保持
        * デメリット:
            オーバーラップしてもなお途切れる箇所はカバーできない
            一つのトピックでの会話を切ってしまう可能性は回避できない
  
#### セグメントレベル分析  
* トピック推定：セグメント内の主要テーマ  
* 時間的文脈推定：過去/現在/未来の区別  
* 暗黙の前提：明示されていない背景的前提  
* セグメントレベルでの話者情報：属性、役割、関係性  
* 第三者/背景情報：言及される非参加者、組織文化、話者の態度  
  
#### 議事録全体分析（セグメントレベル分析の結果をサマリー）  
* シチュエーション：会話の状況や背景  
* 会話目的：対話の主目的  
* トピック遷移：話題の変化・発展パターン  
* 支配的なフレーミング：議論を枠付ける視点  
* 組織的背景：組織文化、方針、暗黙の規範  
* 話者の総合分析：関係性、属性/役割、社会的位置性、第三者・組織方針への態度  
  
セグメントレベル分析と議事録全体分析はintermediate_reportディレクトリ内に保存  
  
## ②MA検出フォーカスポイント抽出  
### 基本プロセス  
1. シチュエーションから推定される認知バイアス型/社会構造型MAリスク分析  
2. 認知バイアス型/社会構造型MAに関連した書籍選定  
  
### 1. リスク分析  
* graphRAG(Local Search)を用いる（書籍は一旦仮置き）  
    * 認知バイアス型→書籍「偏見や差別はなぜ起こる？」  
    * 社会構造型→書籍「差別の哲学入門」  
* ここでは、MAの断定はせずリスクの分析を行う  
* リスクのカテゴリーはここで定義した内容（検出対象）  
* 入力  
    * 議事録全体分析結果の内容 #議事録本文は入れない（シチュエーションからのリスク判定）  
  
|本分析との違い  
  リスク分析：会議メタデータから「起こりうるリスク」を予測  
  本分析：実際の発言内容から「実際に起きたマイクロアグレッション」を検出|
|:-|
  
|認知バイアス型MAについては、各項目に基づいて有り無し判定をした方がいい（きちんとコントロールできるように）  
→まずは1stステップとして、「1.カテゴリー化とステレオタイプ」のみを対象に行う  
→認知バイアス型MAについてはリスク分析なく、いきなり本分析を行い、そこでTrueとなったセグメントに対して、選択されたカテゴリーと紐づく書籍で深堀分析でいいかも（偏見や差別はなぜ起こる？に網羅的に記載があるので）|
|:-|
  
|これまでは判定の内容についてLLM(graphRAG)に委ねている部分が大きかったが、  
ver2.0では「selfcareAIにおけるMAの定義」に沿って判定する方向で進める  
    * メリット：カテゴリー分けされるのである程度一貫性をもって処理される  
    * デメリット：定義漏れ→例えばユーザフィードバックで吸い上げる、などほかの手段でも対応・発展できそう|
|:-|
  
### 2. 書籍選定  
* プロンプトベースで行う（書籍の情報を含めたプロンプト）# vs アルゴリズムでもいいかも  
* 書籍のデータベース化  
    * タグ付け（overview.txtをアップデート）  
    * 認知バイアス型、社会構造型で分類  
    * ~~社会構造型MAに向けた客観的データ（公的レポートなど）を増やす~~  
      ⇒客観データは分析レポートではなく、チャットAIなどに回す
  
* 認知バイアス型MA（ステレオタイプ）  
  →「偏見や差別はなぜ起こる？」一冊なので選定フェーズ設けない  
  
* 社会構造型MA  
  →「差別の哲学入門」「日常生活に埋め込まれたマイクロアグレッション」「差別はたいてい悪意のない人がする」  
